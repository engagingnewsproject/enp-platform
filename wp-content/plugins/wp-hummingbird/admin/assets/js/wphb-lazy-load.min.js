!function(){"use strict";var t={commentsFormLoading:!1,commentsLoading:!1,commentsLoadComplete:!1,commentsLoaded:0,loadOnScroll:!1,loadCommentFormOnScroll:!1,commentLoadingMethod:"click",pageCommentsOption:0,totalCommentsPages:1,commentsPageOrder:"newest",cpageNum:1,postId:0,commentNonce:"",commentsContainer:null,commentList:null,loadCommentsButton:null,loadCommentsButtonWrap:null,commentsEndIndicator:null,commentsLoadSpinnerWrap:null,ajaxurl:null,preloadComment:!1,init:function(){wphbGlobal?this.ajaxurl=wphbGlobal.ajaxurl:this.ajaxurl=ajaxurl,document.getElementById("wphb-comments-wrap")&&this.initCommentLazyLoader()},initCommentLazyLoader:function(){this.commentLoadingMethod=document.getElementById("wphb-load-comments-method").value,this.pageCommentsOption=parseInt(document.getElementById("wphb-page-comments-option").value),this.totalCommentsPages=parseInt(document.getElementById("wphb-total-comments-pages").value),this.commentsPageOrder=document.getElementById("wphb-comments-page-order").value,this.cpageNum=parseInt(document.getElementById("wphb-cpage-num").value),this.preloadComment=Boolean(wphbGlobal.preloadComment),!0===this.preloadComment&&(this.cpageNum="newest"===this.commentsPageOrder?this.cpageNum-1:this.cpageNum+1),this.postId=parseInt(document.getElementById("wphb-post-id").value),this.commentNonce=document.getElementById("comment-template-nonce").value,this.commentsContainer=document.getElementById("wphb-comments-container"),this.commentsEndIndicator=document.getElementById("wphb-comments-end-indicator"),this.commentsLoadSpinnerWrap=document.getElementById("wphb-load-comments-spinner-wrap"),"click"===this.commentLoadingMethod&&(this.loadCommentsButton=document.getElementById("wphb-load-comments"),this.loadCommentsButtonWrap=document.getElementById("wphb-load-comments-button-wrap")),!0===this.preloadComment&&(this.cpageNum<1||this.cpageNum>t.totalCommentsPages?t.finishCommentLoad():t.enableCommentLoad(),t.putCommentContent(wphbGlobal.commentForm,!1)),"click"===this.commentLoadingMethod&&(this.loadCommentsButton.addEventListener("click",(function(){return t.loadComments()})),!0!==this.preloadComment&&(this.loadCommentFormOnScroll=!0,window.addEventListener("scroll",t.handleScrollingForLoadForm),t.handleScrollingForLoadForm())),"scroll"===this.commentLoadingMethod&&(this.loadOnScroll=!0,window.addEventListener("scroll",(function(){return t.handleScrolling()})),t.handleScrolling())},enableCommentLoad:function(){this.loadCommentsButton&&this.loadCommentsButton.removeAttribute("disabled"),this.loadOnScroll=!0},disableCommentLoad:function(){this.loadCommentsButton&&this.loadCommentsButton.setAttribute("disabled","disabled"),this.loadOnScroll=!1,this.loadCommentFormOnScroll=!1},moveLoadButton:function(){this.loadCommentsButton&&this.insertAfter(this.loadCommentsButtonWrap,this.commentList)},moveCommentsEndIndicator:function(){this.insertAfter(this.commentsEndIndicator,this.commentList)},moveCommentForm:function(){var t=document.getElementById("respond");t&&this.insertBefore(t,this.commentList)},hideLoadButton:function(){this.loadCommentsButton&&(this.loadCommentsButton.style.display="none")},showCommentLoadSpinner:function(){this.commentsLoadSpinnerWrap.style.display="block"},hideCommentLoadSpinner:function(){this.commentsLoadSpinnerWrap.style.display="none"},moveCommentLoadSpinner:function(){this.insertAfter(this.commentsLoadSpinnerWrap,this.commentList)},finishCommentLoad:function(){this.commentsLoading=!1,this.disableCommentLoad(),this.hideLoadButton()},handleScrolling:function(){if(!this.loadOnScroll||!this.isInViewport(this.commentsEndIndicator))return null;this.loadComments()},handleScrollingForLoadForm:function(){if(!t.loadCommentFormOnScroll||!t.isInViewport(t.commentsEndIndicator))return null;window.removeEventListener("scroll",t.handleScrollingForLoadForm),t.loadCommentsForm()},loadCommentsForm:function(){this.commentsFormLoading=!0,this.loadComments()},loadComments:function(){if(this.commentsLoadComplete||this.commentsLoading)return!1;this.getCommentsTemplate()},getCommentsTemplate:function(){this.disableCommentLoad(),this.showCommentLoadSpinner();var e=new XMLHttpRequest;this.commentsLoading=!0,e.open("GET",t.ajaxurl+"?action=get_comments_template&id="+t.postId+"&cpage_num="+t.cpageNum+"&_nonce="+t.commentNonce),e.onload=function(){if(200===e.status){var n=JSON.parse(e.responseText);void 0!==n.data?(!0===t.commentsFormLoading?t.enableCommentLoad():(t.commentsLoaded++,t.cpageNum="newest"===t.commentsPageOrder?t.cpageNum-1:t.cpageNum+1,t.cpageNum<1||t.cpageNum>t.totalCommentsPages?t.finishCommentLoad():t.enableCommentLoad()),t.putCommentContent(n.data.content),!0===t.commentsFormLoading&&(t.commentsFormLoading=!1)):t.enableCommentLoad()}else t.enableCommentLoad();t.commentsLoading=!1,t.hideCommentLoadSpinner()},e.send()},putCommentContent:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.stringToHTML(e),m=o.querySelector(".comment");if(null===m&&(m=o.querySelector(".review")),m){var i=m.parentNode;!0===t.commentsFormLoading&&(i.innerHTML=""),!0===n&&(this.commentsLoaded>1||"click"===this.commentLoadingMethod&&!1===t.commentsFormLoading)?this.commentList.innerHTML+=i.innerHTML:(this.commentsContainer.appendChild(o),this.commentList=i,this.moveCommentsEndIndicator(),this.moveCommentLoadSpinner(),this.moveLoadButton(),"scroll"===this.commentLoadingMethod&&this.moveCommentForm()),!0!==n&&t.commentsLoaded++}},stringToHTML:function(t){t="<div>"+t+"</div>";var e=function(){if(!window.DOMParser)return!1;var t=new DOMParser;try{t.parseFromString("x","text/html")}catch(t){return!1}return!0}();if(e)return(new DOMParser).parseFromString(t,"text/html").body.firstChild;var n=document.createElement("div");return n.innerHTML=t,n.firstChild},insertAfter:function(t,e){e.parentNode.insertBefore(t,e.nextSibling)},insertBefore:function(t,e){e.parentNode.insertBefore(t,e)},isInViewport:function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}};document.addEventListener("DOMContentLoaded",(function(){t.init()}))}();
//# sourceMappingURL=wphb-lazy-load.min.js.map