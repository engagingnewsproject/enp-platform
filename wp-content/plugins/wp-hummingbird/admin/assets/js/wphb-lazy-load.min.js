!function(){"use strict";var t={commentsFormLoading:!1,commentsLoading:!1,commentsLoadComplete:!1,commentsLoaded:0,loadOnScroll:!1,loadCommentFormOnScroll:!1,commentLoadingMethod:"click",pageCommentsOption:0,totalCommentsPages:1,commentsPageOrder:"newest",cpageNum:1,postId:0,commentNonce:"",commentsContainer:null,commentList:null,loadCommentsButton:null,loadCommentsButtonWrap:null,commentsEndIndicator:null,commentsLoadSpinnerWrap:null,ajaxurl:null,init:function(){wphbGlobal?this.ajaxurl=wphbGlobal.ajaxurl:this.ajaxurl=ajaxurl,document.getElementById("wphb-comments-wrap")&&this.initCommentLazyLoader()},initCommentLazyLoader:function(){this.commentLoadingMethod=document.getElementById("wphb-load-comments-method").value,this.pageCommentsOption=parseInt(document.getElementById("wphb-page-comments-option").value),this.totalCommentsPages=parseInt(document.getElementById("wphb-total-comments-pages").value),this.commentsPageOrder=document.getElementById("wphb-comments-page-order").value,this.cpageNum=parseInt(document.getElementById("wphb-cpage-num").value),this.postId=parseInt(document.getElementById("wphb-post-id").value),this.commentNonce=document.getElementById("comment-template-nonce").value,this.commentsContainer=document.getElementById("wphb-comments-container"),this.commentsEndIndicator=document.getElementById("wphb-comments-end-indicator"),this.commentsLoadSpinnerWrap=document.getElementById("wphb-load-comments-spinner-wrap"),"click"===this.commentLoadingMethod&&(this.loadCommentsButton=document.getElementById("wphb-load-comments"),this.loadCommentsButtonWrap=document.getElementById("wphb-load-comments-button-wrap")),"click"===this.commentLoadingMethod&&(this.loadCommentsButton.addEventListener("click",(function(){return t.loadComments()})),this.loadCommentFormOnScroll=!0,window.addEventListener("scroll",t.handleScrollingForLoadForm),t.handleScrollingForLoadForm()),"scroll"===this.commentLoadingMethod&&(this.loadOnScroll=!0,window.addEventListener("scroll",(function(){return t.handleScrolling()})),t.handleScrolling())},enableCommentLoad:function(){this.loadCommentsButton&&this.loadCommentsButton.removeAttribute("disabled"),this.loadOnScroll=!0},disableCommentLoad:function(){this.loadCommentsButton&&this.loadCommentsButton.setAttribute("disabled","disabled"),this.loadOnScroll=!1,this.loadCommentFormOnScroll=!1},moveLoadButton:function(){this.loadCommentsButton&&this.insertAfter(this.loadCommentsButtonWrap,this.commentList)},moveCommentsEndIndicator:function(){this.insertAfter(this.commentsEndIndicator,this.commentList)},moveCommentForm:function(){var t=document.getElementById("respond");t&&this.insertBefore(t,this.commentList)},hideLoadButton:function(){this.loadCommentsButton&&(this.loadCommentsButton.style.display="none")},showCommentLoadSpinner:function(){this.commentsLoadSpinnerWrap.style.display="block"},hideCommentLoadSpinner:function(){this.commentsLoadSpinnerWrap.style.display="none"},moveCommentLoadSpinner:function(){this.insertAfter(this.commentsLoadSpinnerWrap,this.commentList)},finishCommentLoad:function(){this.commentsLoading=!1,this.disableCommentLoad(),this.hideLoadButton()},handleScrolling:function(){if(!this.loadOnScroll||!this.isInViewport(this.commentsEndIndicator))return null;this.loadComments()},handleScrollingForLoadForm:function(){if(!t.loadCommentFormOnScroll||!t.isInViewport(t.commentsEndIndicator))return null;window.removeEventListener("scroll",t.handleScrollingForLoadForm),t.loadCommentsForm()},loadCommentsForm:function(){this.commentsFormLoading=!0,this.loadComments()},loadComments:function(){if(this.commentsLoadComplete||this.commentsLoading)return!1;this.getCommentsTemplate()},getCommentsTemplate:function(){this.disableCommentLoad(),this.showCommentLoadSpinner();var n=new XMLHttpRequest;this.commentsLoading=!0,n.open("GET",t.ajaxurl+"?action=get_comments_template&id="+t.postId+"&cpage_num="+t.cpageNum+"&_nonce="+t.commentNonce),n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);void 0!==e.data?(!0===t.commentsFormLoading?t.enableCommentLoad():(t.commentsLoaded++,t.cpageNum="newest"===t.commentsPageOrder?t.cpageNum-1:t.cpageNum+1,t.cpageNum<1||t.cpageNum>t.totalCommentsPages?t.finishCommentLoad():t.enableCommentLoad()),t.putCommentContent(e.data.content),!0===t.commentsFormLoading&&(t.commentsFormLoading=!1)):t.enableCommentLoad()}else t.enableCommentLoad();t.commentsLoading=!1,t.hideCommentLoadSpinner()},n.send()},putCommentContent:function(n){var e=this.stringToHTML(n),o=e.querySelector(".comment");if(o){var m=o.parentNode;!0===t.commentsFormLoading&&(m.innerHTML=""),this.commentsLoaded>1||"click"===this.commentLoadingMethod&&!1===t.commentsFormLoading?this.commentList.innerHTML+=m.innerHTML:(this.commentsContainer.appendChild(e),this.commentList=m,this.moveCommentsEndIndicator(),this.moveCommentLoadSpinner(),this.moveLoadButton(),"scroll"===this.commentLoadingMethod&&this.moveCommentForm())}},stringToHTML:function(t){t="<div>"+t+"</div>";var n=function(){if(!window.DOMParser)return!1;var t=new DOMParser;try{t.parseFromString("x","text/html")}catch(t){return!1}return!0}();if(n)return(new DOMParser).parseFromString(t,"text/html").body.firstChild;var e=document.createElement("div");return e.innerHTML=t,e.firstChild},insertAfter:function(t,n){n.parentNode.insertBefore(t,n.nextSibling)},insertBefore:function(t,n){n.parentNode.insertBefore(t,n)},isInViewport:function(t){var n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}};document.addEventListener("DOMContentLoaded",(function(){t.init()}))}();
//# sourceMappingURL=wphb-lazy-load.min.js.map